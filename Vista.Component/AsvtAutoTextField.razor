@using MudBlazor.Utilities
@inherits AsvtFieldBase<string>

@* Autocomplete text input, 可以自由輸入(free solo)，也可以選取最近或常用的文字敘述。 *@
@* 建議未來改名成：AsvtSelectSoloField。命名依照 Material Design 典範 *@
@* ※ 屬性 SelectValueOnTab = false 設成 true 會讓下一個 select 元件掉入無限遞迴！ *@
<MudItem xs=@_xs sm=@_sm md=@_md lg=@_lg xl=@_xl xxl=@_xxl>
  <MudAutocomplete T="String"
                   @bind-Value=FieldValue
                   Immediate=@Immediate
                   Label=@_label
                   ReadOnly=@_readOnly
                   HelperText=@HelperText
                   Required=@Required
                   Class=@CssClass
                   Variant=@(_readOnly ? Variant.Filled : Variant.Text)
                   Error=@ValidationError
                   ErrorText=@ValidationErrorText
                   SearchFunc=@TextRepo.SearchFunc
                   MaxItems=@MaxItems
                   MaxHeight="500"
                   AdornmentIcon=@Icons.Material.Filled.ManageSearch
                   DebounceInterval=300
                   Clearable=false
                   ResetValueOnEmptyText=true
                   CoerceValue=true
                   CoerceText=false
                   Strict=false
                   SelectValueOnTab=true
                   SelectOnActivation=false
                   OpenOnFocus=false
                   ShowProgressIndicator=true
                   ProgressIndicatorColor=Color.Info>
    <MoreItemsTemplate>
      <MudText Align="Align.Center" Class="px-4 py-1 mud-theme-dark">
        @($"只顯示前{MaxItems}/{TextRepo.TextList.Length}筆")
      </MudText>
    </MoreItemsTemplate>
  </MudAutocomplete>
</MudItem>

@code {
  /// <summary>
  /// the CodeName Repository
  /// </summary>
  [Parameter, EditorRequired] public TextRepoBase TextRepo { get; init; } = default!;

  /// <summary>
  /// 呈現下拉項目筆數。null 表示不限制。
  /// </summary>
  [Parameter] public int? MaxItems { get; set; } = 100;

  string CssClass => new CssBuilder()
    .AddClass("asvt-dropdown-field-no-pointer-events", _readOnly)
    .Build();
}