@using Vista.Biz.DataPicking

<style>
  .selected {
    background-color: var(--mud-palette-info) !important;
  }

    .selected > td {
      color: white !important;
    }

      .selected > td .mud-input {
        color: white !important;
      }
</style>

<MudTable T="CustomCodeInfo" Items=ItemList Hover Striped Dense Elevation=0
          FixedHeader Height="calc(100vh - 400px)"
          RowClassFunc=SelectedRowClassFunc
          OnRowClick=HandleRowClick
          Filter=FilterFunc>
  <ToolBarContent>
    <MudText Typo="Typo.h6">Custom Info</MudText>
    <MudSpacer />
    <MudTextField @bind-Value=@_filterString Placeholder="過濾" Class="mt-0"
                  Adornment=Adornment.Start AdornmentIcon=@Icons.Material.Outlined.FilterAlt />
  </ToolBarContent>
  <HeaderContent>
    <MudTh>Code</MudTh>
    <MudTh>Name</MudTh>
    <MudTh>Group</MudTh>
    <MudTh>FieldA</MudTh>
    <MudTh>FieldB</MudTh>
    <MudTh>FieldC</MudTh>
  </HeaderContent>
  <RowTemplate>
    <MudTd DataLabel="Code">@context.Code</MudTd>
    <MudTd DataLabel="Name">@context.Name</MudTd>
    <MudTd DataLabel="Group">@context.Group</MudTd>
    <MudTd DataLabel="FieldA">@context.FieldA</MudTd>
    <MudTd DataLabel="FieldB">@context.FieldB</MudTd>
    <MudTd DataLabel="FieldC">@context.FieldC</MudTd>
  </RowTemplate>
</MudTable>

@code {
  [Parameter, EditorRequired] public required IEnumerable<CustomCodeInfo> ItemList { get; set; }

  [Parameter, EditorRequired] public CustomCodeInfo? SelectedItem { get; set; }
  [Parameter, EditorRequired] public EventCallback<CustomCodeInfo> SelectedItemChanged { get; set; }

  //## State
  string _filterString = string.Empty;

  Task HandleRowClick(TableRowClickEventArgs<CustomCodeInfo> e)
  {
    SelectedItemChanged.InvokeAsync(e.Item);
    return Task.CompletedTask;
  }

  bool FilterFunc(CustomCodeInfo item)
  {
    return (item.Code != null && item.Code.Contains(_filterString)) ||
        (item.Name != null && item.Name.Contains(_filterString)) ||
        (item.Group != null && item.Group.Contains(_filterString));
  }

  string SelectedRowClassFunc(CustomCodeInfo item, int rowNumber)
  {
    return (SelectedItem != null && SelectedItem.Code == item.Code) ? "selected" : string.Empty;
  }
}
